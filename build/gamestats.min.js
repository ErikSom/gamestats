!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).GameStats=e()}(this,(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function i(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return a(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,n=!0,l=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return n=t.done,t},e:function(t){l=!0,h=t},f:function(){try{n||null==i.return||i.return()}finally{if(l)throw h}}}}var s=function(){function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,a);var i={autoPlace:!0,targetFPS:60,redrawInterval:50,maximumHistory:100,scale:1,memoryUpdateInterval:1e3,memoryMaxHistory:600,FONT_FAMILY:"Arial",COLOR_FPS_BAR:"#34cfa2",COLOR_FPS_AVG:"#FFF",COLOR_TEXT_LABEL:"#FFF",COLOR_TEXT_TO_LOW:"#eee207",COLOR_TEXT_BAD:"#d34646",COLOR_TEXT_TARGET:"#d249dd",COLOR_BG:"#333333"};this.config=Object.assign(i,e),this.dom,this.canvas,this.ctx,this.currentTime,this.prevTime,this.shown=!0,this.lastMSAverage,this.lastMemoryMeasure=-Number.POSITIVE_INFINITY,this.labels={},this.labelColors={ms:this.config.COLOR_FPS_BAR,memory:this.config.COLOR_FPS_BAR},this.labelOrder=[],this.graphYOffset=0,this.config.baseCanvasWidth=100*this.config.scale,this.config.baseCanvasHeight=150*this.config.scale,this.msGraph={width:this.config.baseCanvasWidth,height:.4*this.config.baseCanvasHeight,drawY:.16*this.config.baseCanvasHeight,barWidth:this.config.baseCanvasWidth/this.config.maximumHistory},this.memoryGraph={width:this.config.baseCanvasWidth,height:.2*this.config.baseCanvasHeight,drawY:.76*this.config.baseCanvasHeight,barWidth:this.config.baseCanvasWidth/this.config.memoryMaxHistory},this.init()}var s,h,n;return s=a,(h=[{key:"init",value:function(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("data","gamestats"),this.canvas.width=this.config.baseCanvasWidth,this.canvas.height=this.config.baseCanvasHeight,this.canvas.style.cssText="position:fixed;left:0;top:0;width:".concat(this.config.baseCanvasWidth*this.config.scale,"px;height:").concat(this.config.baseCanvasHeight*this.config.scale,"px;background-color:").concat(this.config.COLOR_BG),this.config.autoPlace&&document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.dom=this.canvas,performance&&performance.memory&&(this.labels.memory=[]),this.update=this.update.bind(this),this.update()}},{key:"begin",value:function(t,e){if(["ms","fps","memory"].includes(t))throw"jsgraphy: label ".concat(t," is reserved");t||(t="ms"),"ms"===t&&this.currentTime&&(this.prevTime=this.currentTime),"ms"===t||this.labelColors[t]||(this.labelColors[t]=e||this.stringToColor(t),this.labelOrder.push(t)),this.labels[t]||(this.labels[t]=[]);var a=this.labels[t];if(a.push(performance.now()),a.length>this.config.maximumHistory&&a.shift(),"ms"===t&&(this.currentTime=performance.now(),this.prevTime)){this.labels.fps||(this.labels.fps=[]);var i=this.labels.fps;i.push(this.currentTime-this.prevTime),i.length>this.config.maximumHistory&&i.shift()}}},{key:"show",value:function(t){this.shown=t,this.dom.style.display=t?"block":"none"}},{key:"end",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ms",e=this.labels[t];if(e){var a=e[e.length-1];e[e.length-1]=performance.now()-a}}},{key:"update",value:function(){if(this.shown&&this.draw(),performance&&performance.memory&&performance.now()-this.lastMemoryMeasure>this.config.memoryUpdateInterval){var t=this.labels.memory;t.push(performance.memory.usedJSHeapSize/r),t.length>this.config.memoryMaxHistory&&t.shift(),this.lastMemoryMeasure=performance.now()}this.canvas&&this.canvas.parentNode&&setTimeout(this.update,this.config.redrawInterval)}},{key:"draw",value:function(){if(this.prevTime){var t=this.ctx,e=t.getImageData(1,0,t.canvas.width-this.msGraph.barWidth,t.canvas.height);t.putImageData(e,0,0),t.clearRect(t.canvas.width-this.msGraph.barWidth,0,this.msGraph.barWidth,t.canvas.height),t.clearRect(0,0,t.canvas.width,.16*t.canvas.height),performance.memory&&t.clearRect(0,.6*t.canvas.height,t.canvas.width,.16*t.canvas.height),this.drawGraph("ms",1e3/this.config.targetFPS),this.drawFPS(),this.graphYOffset=0;var a,s=i(this.labelOrder);try{for(s.s();!(a=s.n()).done;){var r=a.value;this.drawGraph(r,this.previousMaxMS,!0)}}catch(t){s.e(t)}finally{s.f()}this.drawLines(),performance&&performance.memory&&this.drawMemory()}}},{key:"drawLines",value:function(){var t=this.config,e=this.ctx,a=1e3/t.targetFPS,i=this.previousAverageMS,s=this.previousMaxMS;e.fillStyle=t.COLOR_FPS_AVG,i>1.66*a?e.fillStyle=t.COLOR_TEXT_BAD:i>1.33*a&&(e.fillStyle=t.COLOR_TEXT_TO_LOW);var r=i/s*this.msGraph.height,h=this.msGraph.drawY+this.msGraph.height-r;e.fillRect(this.msGraph.width-this.msGraph.barWidth,h,this.msGraph.barWidth,this.msGraph.barWidth),e.fillStyle=t.COLOR_TEXT_TARGET;var n=a/s*this.msGraph.height,l=this.msGraph.drawY+this.msGraph.height-n;e.fillRect(this.msGraph.width-this.msGraph.barWidth,l,this.msGraph.barWidth,this.msGraph.barWidth)}},{key:"drawGraph",value:function(t,e,a){var i=this.labels[t],s=this.getMMA(i),r=s.max,h=s.average;r=Math.max(1.5*h,r),e&&(r=Math.max(e,r));var n=this.config,l=this.ctx,o=i[i.length-1],c=0;a&&this.graphYOffset&&(c+=this.graphYOffset);var m=n.maximumHistory*this.msGraph.barWidth-this.msGraph.barWidth,f=this.msGraph.drawY,d=this.msGraph.barWidth,p=o/r*this.msGraph.height;f+=this.msGraph.height-p-c,l.globalAlpha=.5,l.fillStyle=this.labelColors[t],l.fillRect(m,f,d,p),l.globalAlpha=1,l.fillRect(m,f,d,d),a&&(this.graphYOffset=(this.graphYOffset||0)+p),"ms"===t&&(this.previousAverageMS=h,this.previousMaxMS=r)}},{key:"drawFPS",value:function(){var t=this.ctx,e=this.config,a=this.labels.fps;if(a){var i=this.getMMA(a),s=i.min,r=i.max,h=i.average,n=Math.round(1e3/h),l=Math.round(1e3/s),o=Math.round(1e3/r),c=this.labels.ms,m=c[c.length-1].toFixed(1),f=Math.round(1e3/a[a.length-1]),d=.01*e.baseCanvasHeight;t.textAlign="left";var p=.09*e.baseCanvasWidth;t.font="".concat(p,"px ").concat(e.FONT_FAMILY),t.textBaseline="top",t.fillStyle=e.COLOR_TEXT_LABEL,t.fillText("avg min max",d,d),p=.12*e.baseCanvasWidth,f<.33*e.targetFPS?t.fillStyle=e.COLOR_TEXT_BAD:f<.66*e.targetFPS&&(t.fillStyle=e.COLOR_TEXT_TO_LOW),t.font="".concat(p,"px ").concat(e.FONT_FAMILY),t.textAlign="right",t.fillText("".concat(f," fps"),e.baseCanvasWidth-d,d),p=.1*e.baseCanvasWidth,t.font="".concat(p,"px ").concat(e.FONT_FAMILY);var g=.12*e.baseCanvasWidth;t.fillText("".concat(m,"ms"),e.baseCanvasWidth-d,g+d),p=.09*e.baseCanvasWidth,t.font="".concat(p,"px ").concat(e.FONT_FAMILY);var v=.175*e.baseCanvasWidth,y=.1*e.baseCanvasWidth,u=.33*e.targetFPS,O=.66*e.targetFPS;t.fillStyle=e.COLOR_FPS_BAR,n<u?t.fillStyle=e.COLOR_TEXT_BAD:n<O&&(t.fillStyle=e.COLOR_TEXT_TO_LOW),t.fillText("".concat(n),v-d,y+d),t.fillStyle=e.COLOR_FPS_BAR,o<u?t.fillStyle=e.COLOR_TEXT_BAD:o<O&&(t.fillStyle=e.COLOR_TEXT_TO_LOW),t.fillText("".concat(o),2.1*v-2*d,y+d),t.fillStyle=e.COLOR_FPS_BAR,l<u?t.fillStyle=e.COLOR_TEXT_BAD:l<O&&(t.fillStyle=e.COLOR_TEXT_TO_LOW),t.fillText("".concat(l),3.3*v-3*d,y+d)}}},{key:"drawMemory",value:function(){var t=this.config,e=this.ctx,a=.01*t.baseCanvasHeight,i=.6*t.baseCanvasHeight;e.textAlign="left";var s=.09*t.baseCanvasWidth;e.font="".concat(s,"px ").concat(t.FONT_FAMILY),e.textBaseline="top",e.fillStyle=t.COLOR_TEXT_LABEL,e.fillText("reserved",a,i+a),e.fillStyle=t.COLOR_TEXT_TARGET,e.textAlign="right";var h=(performance.memory.jsHeapSizeLimit/r).toFixed(1);e.fillText("".concat(h,"MB"),t.baseCanvasWidth-a,i+a),e.textAlign="left",e.fillStyle=t.COLOR_TEXT_LABEL,e.fillText("allocated",a,1.12*i+a),e.textAlign="right";var n=(performance.memory.usedJSHeapSize/r).toFixed(1);e.fillStyle=t.COLOR_FPS_BAR,n>.9*h?e.fillStyle=t.COLOR_TEXT_BAD:n>.66*h&&(e.fillStyle=t.COLOR_TEXT_TO_LOW),e.fillText("".concat(n,"MB"),t.baseCanvasWidth-a,1.12*i+a);var l=performance.memory.jsHeapSizeLimit/r,o=this.labels.memory,c=o[o.length-1],m=this.memoryGraph.width-6*this.memoryGraph.barWidth,f=this.memoryGraph.drawY,d=6*this.memoryGraph.barWidth,p=c/l*this.memoryGraph.height;f+=this.memoryGraph.height-p,e.globalAlpha=.5,e.fillStyle=this.labelColors.memory,e.fillRect(m,f,d,p),e.globalAlpha=1,e.fillRect(m,f,d,d);var g=this.getMMA(this.labels.memory).average;e.fillStyle=t.COLOR_FPS_AVG,g>.9*l?e.fillStyle=t.COLOR_TEXT_BAD:g>.66*l&&(e.fillStyle=t.COLOR_TEXT_TO_LOW);var v=g/l*this.memoryGraph.height,y=this.memoryGraph.drawY+this.memoryGraph.height-v;e.fillRect(this.memoryGraph.width-6*this.memoryGraph.barWidth,y,6*this.memoryGraph.barWidth,6*this.memoryGraph.barWidth),e.fillStyle=t.COLOR_TEXT_TARGET;var u=this.memoryGraph.height,O=this.memoryGraph.drawY+this.memoryGraph.height-u;e.fillRect(this.memoryGraph.width-6*this.memoryGraph.barWidth,O,6*this.memoryGraph.barWidth,6*this.memoryGraph.barWidth)}},{key:"getMMA",value:function(t){var e,a=Number.POSITIVE_INFINITY,s=-Number.POSITIVE_INFINITY,r=0,h=i(t);try{for(h.s();!(e=h.n()).done;){var n=e.value;n<a&&(a=n),n>s&&(s=n),r+=n}}catch(t){h.e(t)}finally{h.f()}return{min:a,max:s,average:r/=t.length}}},{key:"stringToColor",value:function(t){for(var e=0,a=0;a<t.length;a++)e=t.charCodeAt(a)+((e<<5)-e);var i=(16777215&e).toString(16).toUpperCase();return"#".concat("00000".substring(0,6-i.length)).concat(i)}}])&&e(s.prototype,h),n&&e(s,n),a}(),r=1048576;return s}));
